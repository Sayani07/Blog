<!DOCTYPE html>
<html>
  <head>
    <title>Visualisation and analysis of probability distributions of variables defined on spatio-temporal granularities</title>
    <meta charset="utf-8">
    <meta name="author" content="  Sayani Gupta     Supervisors:   Prof. Rob J Hyndman     Prof. Dianne Cook     Dr. Peter Toscas" />
    <link href="ConTalk_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="data_viz_theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Visualisation and analysis of probability distributions of variables defined on spatio-temporal granularities
### <br> Sayani Gupta <br> <br> Supervisors:   Prof. Rob J Hyndman     Prof. Dianne Cook     Dr. Peter Toscas
### <font size="5"> Department of Econometrics and Business Statistics <br> February 28, 2019

---




# &lt;span style="color:DarkBlue"&gt; Agenda

- Motivation
- Research aim
- What is EDA? How it can help?
- Research objectives
  - Visualizing probability distributions on deconstructed time
  - Spatio-temporal granularities and probability distribution plots
  - Clustering algorithms for grouping probability distributions on spatio-temporal granularities
- Timeline
- Acknowledgements

---

# &lt;span style="color:DarkBlue"&gt; Motivation

## Electricity smart meter technology 

Smart meters record electricity usage (per kWh) every 30 minutes and send this information to the electricity retailer for billing

.pull-left[
**Consumers** can save considerable amount on their electricity bill by 
&lt;br&gt;
- Switching on their hot water heater or do laundry when energy is cheaper, or when their solar system is generating surplus energy 
- Switching off appliances during peak demands
- Check usage and compare with similar homes 
]
.pull-right[

**Retailers** can reduce costs and increase efficiency
- Lowering metering and connection fees 
- Drawing insights into when customer is home, or sleeping, or even what appliances they are using based on usage figures
- Rewarding customers for mindful usage
]

---

## &lt;span style="color:DarkBlue"&gt;  Data description (~ 40 billion half hourly observations)

.pull-left[

.center-left[
- Source
&lt;br&gt;
&lt;br&gt;
- Frequency
&lt;br&gt;
&lt;br&gt;
- Time Frame
&lt;br&gt;
&lt;br&gt;
- Spread
&lt;br&gt;
&lt;br&gt;
- Type
&lt;br&gt;
&lt;br&gt;
- Dimension
]
]

.pull-right[
.center-left[
Data61, CSIRO
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
Half hourly interval meter reading (Kwh)
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
2012 to 2014
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
14K (approx.) households based in Newcastle, New South Wales, and parts of Sydney
&lt;br&gt;
&lt;br&gt;
Spatio - Temporal Data
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
Univariate
]
]

---
class: middle left

# &lt;span style="color:DarkBlue"&gt;  Research aim

## &lt;span style="color:Black"&gt; Provide a platform to &lt;span style="color:Crimson"&gt; systematically explore &lt;span style="color:Black"&gt;  multiple perspectives of &lt;span style="color:Crimson"&gt; spatio-temporal data &lt;span style="color:Black"&gt; across deconstructed time and space to find regular patterns or anomalies, explore clusters of behaviors or summarize the behavior through &lt;span style="color:Crimson"&gt; visualizing probability distributions &lt;span style="color:Black"&gt;

---
## &lt;span style="color:DarkBlue"&gt;  What is Exploratory Data Analysis?

.pull-left[
&lt;br&gt;
.center[
&lt;img src="EDA.png" height=400px&gt;
]
]
.pull-right[
&lt;br&gt;
&lt;br&gt;
Developed by **John Tukey** as a way of _*systematically*_ using the tools of statistics on a problem before a hypotheses about the data were developed

###  How can it help?

 - Big problem broken into pieces by focusing on subsets
&lt;br&gt;
 - Visualization of &lt;span style="color:Crimson"&gt; probability distributions &lt;span style="color:Black"&gt; at varying resolutions of time and space
&lt;br&gt;
 - Find regular patterns/ anomalies or pockets of similar behavior
&lt;br&gt;
 - Each visual representation poses a question
&lt;br&gt;
 - Action: draw insights or refine question
]

---

class: middle left

# &lt;span style="color:DarkBlue"&gt; Research objectives

## 1. Visualization of probability distributions of deconstructed temporal data

## 2. Spatio-temporal granularities and probability distribution plots

## 3. Clustering algorithms for grouping probability distributions on spatio-temporal granularities


---
class: middle center

# &lt;span style="color:DarkBlue"&gt; Visualization of probability distributions of deconstructed temporal data

---

# &lt;span style="color:DarkBlue"&gt; Deconstructing temporal data - Granularities

.pull-left[
## Arrangement of time

 a) Linear  
 b) Cyclic
&lt;br&gt;
&lt;br&gt;
- &lt;span style="color:#c33c3c"&gt; **Granularities** : &lt;span style="color:Black"&gt;  Abstractions of time based on Calendar
&lt;br&gt;
&lt;br&gt;
- &lt;span style="color:#c33c3c"&gt; **Linear granularities** : &lt;span style="color:Black"&gt; Days, weeks, months, years
&lt;br&gt;
&lt;br&gt;
- &lt;span style="color:#c33c3c"&gt; **Circular granularities** : &lt;span style="color:Black"&gt; DoW, MoY or HoD and nearly circular granularities like DoM or WoM   
]

.pull-right[
![](ConTalk_files/figure-html/linear-cyclic-1.png)&lt;!-- --&gt;
&lt;img src="circular.png" width="50%" /&gt;
]

---
class: top center


# &lt;span style="color:DarkBlue"&gt; Visualizing distributions across circular granularities (I)
&lt;font size="3"&gt; **Source** ~ Buildings and Property Division at Monash University  **Frequency** ~ 30 minutes interval smart meter data of Monash Residential Services, &lt;font size="3"&gt; **Time frame** ~ April 4, 2018 to May 31, 2018, &lt;font size="-1"&gt; **Spread** ~ 73 living units


.left-column[
![](ConTalk_files/figure-html/b105-11-1.png)&lt;!-- --&gt;
]
--
.right-column[
.pull-left[
![](ConTalk_files/figure-html/b429-12-1.png)&lt;!-- --&gt;
]
.pull-right[
![](ConTalk_files/figure-html/b429-13-1.png)&lt;!-- --&gt;
]
]
---
class: middle left

# &lt;span style="color:DarkBlue"&gt; Interpretations

- ### Aggregating information across different circular granularities communicates completely different aspects of data
&lt;br&gt;
- ### Exhaustive sets of visual representation required for multiple perspectives on data

---

class: middle left

# &lt;span style="color:DarkBlue"&gt; Visualizing distributions across circular granularities (II)
  
.pull-left[
### Can combinations of these circular granularities be plotted for effective exploration?
&lt;br&gt;
a) &lt;span style="color:Crimson"&gt; Day-of-Year &lt;span style="color:Black"&gt; and &lt;span style="color:Crimson"&gt; Day-of-Month &lt;span style="color:Black"&gt;  
b) &lt;span style="color:Crimson"&gt;Week-of-Month &lt;span style="color:Black"&gt; and &lt;span style="color:Crimson"&gt;Day-of-Month
&lt;span style="color:Black"&gt;  
c) &lt;span style="color:Crimson"&gt;Week-of-Month &lt;span style="color:Black"&gt;and &lt;span style="color:Crimson"&gt;Week-of-Year
&lt;span style="color:Black"&gt;  
d) &lt;span style="color:Crimson"&gt;Month-of-Year &lt;span style="color:Black"&gt; and &lt;span style="color:Crimson"&gt;Day-of-Year
&lt;span style="color:Black"&gt;  
&lt;br&gt;

- **Frequency** ~ 30 minutes interval smart meter data  
- **Time frame** ~ January, 2002 to March 1, 2015 
- **Spread** ~ Australian States (Victoria chosen)

]

.pull-right[


&lt;img src="ConTalk_files/figure-html/allFig-1.png" width="120%" height="400" style="display: block; margin: auto;" /&gt;
]
---


# &lt;span style="color:DarkBlue"&gt; Harmonies and Clashes

### **Harmonies: ** &lt;span style="color:Black"&gt; Combinations of circular granularities which facilitate EDA when plotted together

Examples: 
- DoW and HoD
- HoD and Working Day/ Non-Working Day
- DoW and MoY

### **Clashes: ** &lt;span style="color:Black"&gt; Combinations of circular granularities which are incompatible for EDA when plotted together

Examples: 
- DoY and DoM
- MoY and DoY
- WoM and DoM


---
class: middle left 
# &lt;span style="color:DarkBlue"&gt; Interpretations

## Calendar Categorisation
.pull-left[
 Categories of `\(C_1\)`: {A, B}  
 Categories of `\(C_2\)`: {X, Y, Z}  
 Combinations: {A, X}, {A, Y}, {A, Z}  
               {B, X}, {B, Y}, {B, Z}
]
.pull-right[
## Missing Combinations of circular granularities
- Structural (Examples: HoD and HoW)
- Non-functional (Examples: Working/Non-working day and HoD)
 ]

## Why Harmonies work and Clashes don't?

- Nature of circular time granularities and their relationship in terms of mapping to calendars

## Need to formalize the theory of granularities to study their properties

---

.pull-left[
# &lt;span style="color:DarkBlue"&gt; Linear Time Granularities &lt;br&gt;

_* "A Glossary of Time Granularity Concepts"* by Bettini et al. _
&lt;br&gt;
&lt;br&gt;

&lt;img src="linear-time-2.png" width="100%" height="290" /&gt;
&lt;br&gt;
&lt;br&gt;
&lt;span style="color:Crimson"&gt;  These definitions for linear granularities are inadequate for conceptualizing circular granularities since the linearity imposes a restriction on reflecting periodicity in time

]
.pull-right[### Definition: Time Domain
A **time domain** is a pair `\((T; \le)\)` where `\(T\)` is a non-empty set of time instants and `\(\le\)` is a total order on `\(T\)`.

### Definition: Linear Granularity
A linear **granularity** is a mapping `\(G\)` from the integers to subsets of the time domain such that:

  (C1) if `\(i &lt; j\)` and `\(G(i)\)` and `\(G(j)\)` are non-empty, then each element of `\(G(i)\)` is less than all elements of `\(G(j)\)`, and  
  &lt;br&gt;
  (C2) if `\(i &lt; k &lt; j\)` and `\(G(i)\)` and `\(G(j)\)` are non-empty, then `\(G(k)\)` is non-empty.  
&lt;br&gt;
&lt;br&gt;
The first condition implies that the granules in a linear granularity are non-overlapping and their index order is same as time order
&lt;br&gt;
&lt;br&gt;
]

---

# &lt;span style="color:DarkBlue"&gt; Circular Time Granularities

.pull-left[
## Idea
- Time domain is a mapping of row numbers to time index in a *_tsibble_*
&lt;br&gt;
&lt;br&gt;
- Linear granularity is a mapping of row numbers to subsets of time domain
&lt;br&gt;
&lt;br&gt;
- Circular granularity is a symbolic representation of time
&lt;br&gt;
&lt;br&gt;
- To design symbolic representation based on modular arithmetic to capture relation with calendars
]

.pull-right[
## Definition 
A **circular granularity** `\(C\)` with a modular period m is defined to be a mapping from the integers `\(Z\)` (Index Set) to `\(Z_m\)`, such that `\(C(s) = (s\mod m)\)` for `\(s \in Z\)` and `\(Z_m = \{0, 1, ..., (m-1)\}\)`, (set of integers modulo `\(m\)`).
&lt;br&gt;
&lt;br&gt;
###  &lt;span style="color: #1B9E77"&gt; Illustrative calendar categorisations
&lt;img src="modarith-table.png" width="90%" /&gt;
&lt;font size="-1"&gt; `\(n_i\)` is the number of categories created by `\(C_i\)`, &amp;nbsp; time index ~ hourly 
]

---

## &lt;span style="color:DarkBlue"&gt; Guiding rules to control for Clashes (I)
.pull-left[
#### &lt;span style="color: #1B9E77"&gt; Structurally Empty Combinations (Examples: HoD and HoW)

&lt;span style="color: Crimson"&gt; **Rule 1** 

For two circular granularities `\(C_1\)` and `\(C_2\)` of the form `\(C_1 = (s \mod m_1)\)` and `\(C_2 = (s \mod m_2)\)` ----&gt;

Choosing `\(m_1, m_2 &gt;1\)` such that `\(HCF(m_2, m_1) &gt; 1\)` will lead to structurally empty combinations for `\(s &gt; m_1m_2\)`  

&lt;span style="color: Crimson"&gt; **Rule 2**

For two circular granularities `\(C_3 = (\lfloor s/a\rfloor   \mod m_1)\)` and `\(C_4 = (\lfloor s/b\rfloor \mod m_2)\)` and `\(s &gt; m_1m_2\)` ----&gt;

Choosing `\(a, b, m_1, m_2 &gt; 1\)` with `\(am_1,bm_2\)` being a perfect multiple of the other one will yield empty combinations provided  `\(am_1 \neq b\)` or `\(bm_2 \neq a\)`.

&lt;font size="-1"&gt; [_*HCF refers to the largest common factor*_] 
]
.pull-right[
## Explanation of Rule 1
&lt;img src="Rule1-improved.png" width="100%" /&gt;

### HoD `\(= s \mod 24\)` ---&gt;  `\(m_1 = 24\)`  
### HoW `\(= s \mod 168\)` ---&gt;  `\(m_2= 24*7\)`  
### `\(HCF(m_2, m_1) = 24 &gt;  1\)`  
### &lt;font size="+2"&gt; &lt;span style="color: Crimson"&gt; (HoD, HoW) ---&gt; Clash

]

---

# &lt;span style="color:DarkBlue"&gt; Guiding rules to control for Clashes (II)

## Brief explanation of Rule 2
.pull-left[
.center[
&lt;img src="Rule2-ex.png" width="60%" /&gt;
&lt;img src="Rule2-miss.png" width="50%" /&gt;
]
]
.pull-right[## &lt;span style="color: #1B9E77"&gt;  Non-functional Empty Combinations (Examples: Working/Non-working day and HoD)

For two circular granularities `\(C_1\)` and `\(C_2\)` with modular period `\(m_1\)` and `\(m_2\)` ----&gt;

Choosing `\(m_1, m_2 &gt;1\)`, such that  `\(m_1m_2 &lt; T/k\)` will lead to non-functional Empty combinations, where k&gt;30 (approx) for density estimates and T is the number of observations for given time index.

### WIP (Finding comprehensive list of rules that objectively guide us to choose Harmonies)
]
---
.left-column[
.center[
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
#&lt;span style="color:DarkBlue"&gt;Timeline
]
]
.right-column[
&lt;table width="120%"&gt; 
&lt;style type="text/css"&gt;
.tg {border-collapse:collapse;border-spacing:0;border-color:#ccc;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-top-width:1px;border-bottom-width:1px;border-color:#ccc;color:#333;background-color:#fff;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-top-width:1px;border-bottom-width:1px;border-color:#ccc;color:#333;background-color:#f0f0f0;}
.tg .tg-wavx{background-color:#ffffff;font-size:14px;font-family:"Comic Sans MS", cursive, sans-serif !important;;border-color:inherit;text-align:left}
.tg .tg-ajri{font-size:13px;font-family:"Comic Sans MS", cursive, sans-serif !important;;background-color:#ffffff;color:#333333;border-color:inherit;text-align:left;vertical-align:top}
.tg .tg-giyz{background-color:#ffffff;font-size:13px;font-family:"Comic Sans MS", cursive, sans-serif !important;;border-color:inherit;text-align:left;vertical-align:top}
.tg .tg-253e{font-size:13px;font-family:"Comic Sans MS", cursive, sans-serif !important;;background-color:#ffffff;border-color:inherit;text-align:left;vertical-align:top}
.tg .tg-v746{background-color:#ffffff;font-size:13px;font-family:"Comic Sans MS", cursive, sans-serif !important;;color:#333333;border-color:inherit;text-align:right;vertical-align:top}
.tg .tg-an6u{font-weight:bold;font-size:14px;font-family:"Comic Sans MS", cursive, sans-serif !important;;background-color:#ffffff;color:#009901;border-color:inherit;text-align:left}
.tg .tg-q7c4{font-size:14px;font-family:"Comic Sans MS", cursive, sans-serif !important;;background-color:#ffffff;border-color:inherit;text-align:left}
.tg .tg-oqet{font-size:14px;font-family:"Comic Sans MS", cursive, sans-serif !important;;background-color:#ffffff;border-color:inherit;text-align:left;vertical-align:top}
.tg .tg-v3iu{background-color:#ffffff;font-size:14px;font-family:"Comic Sans MS", cursive, sans-serif !important;;border-color:inherit;text-align:left;vertical-align:top}
.tg .tg-cjxt{background-color:#ffffff;font-size:13px;font-family:"Comic Sans MS", cursive, sans-serif !important;;color:#333333;border-color:inherit;text-align:left;vertical-align:top}
&lt;/style&gt;
&lt;table class="tg"&gt;
  &lt;tr&gt;
    &lt;th class="tg-an6u"&gt;Year&lt;/th&gt;
    &lt;th class="tg-an6u"&gt;Period&lt;/th&gt;
    &lt;th class="tg-an6u"&gt;Description&lt;/th&gt;
    &lt;th class="tg-an6u"&gt;Product&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-q7c4"&gt;2019&lt;/td&gt;
    &lt;td class="tg-wavx"&gt;February&lt;/td&gt;
    &lt;td class="tg-q7c4"&gt;Candidature Confirmation&lt;/td&gt;
    &lt;td class="tg-wavx"&gt;Milestone&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-q7c4"&gt;&lt;/td&gt;
    &lt;td class="tg-wavx"&gt;May&lt;/td&gt;
    &lt;td class="tg-q7c4"&gt;Research Aim-1&lt;/td&gt;
    &lt;td class="tg-wavx"&gt;R Package&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-q7c4"&gt;&lt;/td&gt;
    &lt;td class="tg-wavx"&gt;June&lt;/td&gt;
    &lt;td class="tg-q7c4"&gt;Research Aim-1&lt;/td&gt;
    &lt;td class="tg-wavx"&gt;Paper&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-oqet"&gt;&lt;/td&gt;
    &lt;td class="tg-v3iu"&gt;June - July&lt;/td&gt;
    &lt;td class="tg-oqet"&gt;Internship (Tentative)&lt;/td&gt;
    &lt;td class="tg-v3iu"&gt;Internship&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-oqet"&gt;&lt;/td&gt;
    &lt;td class="tg-v3iu"&gt;December&lt;/td&gt;
    &lt;td class="tg-oqet"&gt;Research Aim - 2&lt;/td&gt;
    &lt;td class="tg-v3iu"&gt;Draft Paper&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-oqet" rowspan="6"&gt;2020&lt;/td&gt;
    &lt;td class="tg-v3iu"&gt;February&lt;/td&gt;
    &lt;td class="tg-oqet"&gt;Mid-Candidature Review&lt;/td&gt;
    &lt;td class="tg-v3iu"&gt;Milestone&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-v3iu"&gt;April &lt;/td&gt;
    &lt;td class="tg-oqet"&gt;Research Aim - 2&lt;/td&gt;
    &lt;td class="tg-v3iu"&gt;R Package&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-giyz"&gt;May&lt;/td&gt;
    &lt;td class="tg-253e"&gt;Research Aim - 2&lt;/td&gt;
    &lt;td class="tg-giyz"&gt;Paper&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-giyz"&gt;June&lt;/td&gt;
    &lt;td class="tg-253e"&gt;Research Internship&lt;/td&gt;
    &lt;td class="tg-giyz"&gt;Internship&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-giyz"&gt;July&lt;/td&gt;
    &lt;td class="tg-253e"&gt;Compstat 2020&lt;br&gt;&lt;/td&gt;
    &lt;td class="tg-giyz"&gt;Conference&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-cjxt"&gt;December&lt;/td&gt;
    &lt;td class="tg-ajri"&gt;Research Aim-3&lt;/td&gt;
    &lt;td class="tg-cjxt"&gt;Draft Paper&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-ajri" rowspan="4"&gt;2021&lt;/td&gt;
    &lt;td class="tg-cjxt"&gt;February&lt;/td&gt;
    &lt;td class="tg-ajri"&gt;Pre-submission Review&lt;/td&gt;
    &lt;td class="tg-cjxt"&gt;Milestone&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-cjxt"&gt;March&lt;/td&gt;
    &lt;td class="tg-ajri"&gt;Research Aim - 3&lt;/td&gt;
    &lt;td class="tg-cjxt"&gt;R Package&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-cjxt"&gt;April&lt;/td&gt;
    &lt;td class="tg-ajri"&gt;Research Aim - 3&lt;/td&gt;
    &lt;td class="tg-cjxt"&gt;Paper&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-cjxt"&gt;May&lt;/td&gt;
    &lt;td class="tg-ajri"&gt;Thesis Submission&lt;/td&gt;
    &lt;td class="tg-cjxt"&gt;Milestone&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
]

---

# &lt;span style="color:DarkBlue"&gt; Acknowledgements

.pull-left[
### Supervisors
&lt;br&gt;
Professor Rob J Hyndman  
&lt;br&gt;
&lt;br&gt;
Professor Dianne Cook  
&lt;br&gt;
&lt;br&gt;
Dr Peter Toscas
&lt;br&gt;
&lt;br&gt;

### Monash University 
### Data61, CSIRO 



]

.pull-right[
### NUMBATS
&lt;br&gt;
&lt;br&gt;
&lt;img src="Numbats.png" width="100%" /&gt;
]

---

class: middle center

# &lt;span style="color:DarkBlue"&gt; Questions?
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
